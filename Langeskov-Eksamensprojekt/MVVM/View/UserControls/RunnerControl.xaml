<UserControl x:Class="MVVM.View.UserControls.RunnerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:MVVM.View.UserControls" xmlns:viewmodel="clr-namespace:MVVM.ViewModel" d:DataContext="{d:DesignInstance Type=viewmodel:RunnerViewModel}"
             mc:Ignorable="d" 
             d:DesignHeight="570" d:DesignWidth="1050">
    
    <UserControl.Resources>
        <CollectionViewSource x:Key="RunnerGroupsSource" 
                              Source="{Binding RunnerGroups}" />
        <CollectionViewSource x:Key="GenderOptionsSource" 
                          Source="{Binding GenderOptions}" />
    </UserControl.Resources>
    
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="200"/>
            <ColumnDefinition Width="30"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="60"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        
        <!--Create Runner Panel-->
        <Border Grid.Column="0" Grid.RowSpan="2"
                CornerRadius="0,20,20,20" d:Background="{StaticResource bg}">

            <StackPanel Margin="5,15,0,0"
                        HorizontalAlignment="Left">

                <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                    <TextBox Style="{StaticResource textBox}" Tag="Fulde Navn"
                         Text="{Binding Name}"
                         Margin="0,15,5,-5" Width="116"/>

                    <ComboBox Style="{StaticResource ComboBoxStyle1}" Tag="køn"
                              Margin="0,20,0,0" Width="64"
                              
                              ItemsSource="{Binding GenderOptions}"
                              SelectedItem="{Binding Gender}"
                              SelectedIndex="-1">
    
                    </ComboBox>

                </StackPanel>

                <StackPanel Orientation="Horizontal">
                    <TextBox Style="{StaticResource textBox}" Tag="Adresse"
                         Text="{Binding Address}"
                         Margin="0,20,0,0" Width="120"/>

                    <TextBox Style="{StaticResource textBox}" Tag="Post Nr."
                         Text="{Binding PostalCode}"
                         Margin="5,20,0,0" Width="60"/>
                </StackPanel>

                <TextBox Style="{StaticResource textBox}" Tag="Email"
                         Text="{Binding Email}"
                         Margin="0,20,0,0"
                         HorizontalAlignment="Left"
                         Width="185"/>

                <TextBox Style="{StaticResource textBox}" Tag="Telefon"
                         Text="{Binding PhoneNumber}"
                         Margin="0,20,0,0"
                         HorizontalAlignment="Left"
                         Width="185"/>

                <ComboBox Style="{StaticResource ComboBoxStyle1}" Tag="Løber Gruppe"
                          Margin="0,20,0,0" Width="auto"
          
                          ItemsSource="{Binding RunnerGroups}"
          
                          DisplayMemberPath="RunnerGroupName" 
                          SelectedValuePath="RunnerGroupID"
                          SelectedValue="{Binding SelectedRunnerGroupID, Mode=TwoWay}">
                </ComboBox>

                <Calendar Style="{StaticResource CalendarStyle1}"
                          CalendarButtonStyle="{StaticResource CalendarButtonStyle1}" 
                          CalendarDayButtonStyle="{StaticResource CalendarDayButtonStyle1}" 
                          CalendarItemStyle="{StaticResource CalendarItemStyle1}"
                          Margin="0,20,0,0"
                          HorizontalAlignment="Left"
                          BorderThickness="1,1,1,2.3"
                          DisplayMode="Decade"
                          SelectedDate="{Binding DateOfBirth, Mode=TwoWay}"
                          Tag="Fødselsdato"/>


                <Button Style="{DynamicResource confirmationButton}" Height="35"
                        Width="160"
                        Margin="0,25,0,0"
                        Content="Tilføj Bruger"
                        Command="{Binding CreateRunnerCommand}">
                </Button>

            </StackPanel>

        </Border>


        <!--Create/Delete Runner Buttons-->
        <RadioButton Style="{StaticResource addButton}"
                     Grid.Column="1" Grid.Row="1"
                     VerticalAlignment="Top"
                     HorizontalAlignment="Left"
                     Margin="0,0,0,0"
                     Panel.ZIndex="1">
            
            <Viewbox Width="20" Height="17" VerticalAlignment="Top"
                     Margin="0,5,3,0">
                <Path Style="{StaticResource AddUserLogo}"
                      Fill="White"/>
            </Viewbox>
        </RadioButton>

        <Button Style="{StaticResource removeButton}"
                Grid.Column="1" Grid.Row="1"
                VerticalAlignment="Bottom"
                HorizontalAlignment="Left"
                Margin="5,0,0,15"
                IsEnabled="{Binding SelectedItem, ElementName=runnerDataGrid}"
                Command="{Binding DeleteRunnerCommand}">

            <Viewbox Width="20" Height="17" VerticalAlignment="Top"
                     Margin="-5,5,0,0">
                <Path Style="{StaticResource RemoveUserLogo}"
                      Fill="White"/>
            </Viewbox>
        </Button>
            
        
        <!--datagrid-->
        <Border Grid.Column="2" Grid.Row="1"
                CornerRadius="0,0,20,0" d:Background="{StaticResource bgDark}" Grid.ColumnSpan="2">

            <DataGrid x:Name="runnerDataGrid" RowStyle="{StaticResource DataGridRowStyle1}" 
                      ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle1}" 
                      Style="{StaticResource DataGridStyle1}" 
                      CanUserAddRows="False"
                      Margin="3,15,0,0" 
                      AutoGenerateColumns="False"
                      CanUserResizeColumns="True"
                      
                      
                      RowEditEnding="runnerDataGrid_RowEditEnding"
                      
                      ItemsSource="{Binding Runners}"
                      SelectedItem="{Binding SelectedRunner}">

                
                <DataGrid.Columns>

                    <DataGridTextColumn Header="ID" Binding="{Binding RunnerID, Mode=OneWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}"
                                        MinWidth="42"
                                        IsReadOnly="True"/>

                    <DataGridTextColumn Header="Navn" Binding="{Binding Name, Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}"
                                        MinWidth="115"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridComboBoxColumn Header="Køn"
                                            MinWidth="80"
                                            EditingElementStyle="{StaticResource DataGridComboBoxStyle}"
                                            ElementStyle="{StaticResource DataGridComboBoxStyle}"                                            
                                            
                                            ItemsSource="{Binding Source={StaticResource GenderOptionsSource}}"
                                            SelectedItemBinding="{Binding Gender, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}">
                    </DataGridComboBoxColumn>

                    <DataGridTextColumn Header="Addresse" Binding="{Binding Address, Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                        MinWidth="95"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridTextColumn Header="Post Nr." Binding="{Binding PostalCode, Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                        MinWidth="72"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridTextColumn Header="Telefon" Binding="{Binding PhoneNumber, Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                        MinWidth="72"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridTextColumn Header="Email" Binding="{Binding Email, Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                        MinWidth="125"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridTextColumn Header="Fødselsdato" Binding="{Binding DateOfBirth, StringFormat='{}{0:d}', Mode=TwoWay, UpdateSourceTrigger=LostFocus, ValidatesOnDataErrors=True}" 
                                        MinWidth="95"
                                        EditingElementStyle="{StaticResource CellEditingStyle1}"/>

                    <DataGridComboBoxColumn Header="BetalingsGruppe"
                                            MinWidth="120"
                                            EditingElementStyle="{StaticResource DataGridComboBoxStyle}"
                                            ElementStyle="{StaticResource DataGridComboBoxStyle}"                                            
                                            
                                            ItemsSource="{Binding Source={StaticResource RunnerGroupsSource}}"
                                            DisplayMemberPath="RunnerGroupName"
                                            SelectedValuePath="RunnerGroupID"
                                            SelectedValueBinding="{Binding RunnerGroupID, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, ValidatesOnDataErrors=True}">
                    </DataGridComboBoxColumn>   

                </DataGrid.Columns>
            </DataGrid>
        </Border>
    </Grid>
</UserControl>
